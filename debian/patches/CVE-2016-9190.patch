From 5d8a0be45aad78c5a22c8d099118ee26ef8144af Mon Sep 17 00:00:00 2001
From: wiredfool <eric-github@soroos.net>
Date: Sun, 25 Sep 2016 10:44:22 +0100
Subject: [PATCH] Memory error in Storage.c when accepting negative image size
 arguments

[backport to jessie]

---
 libImaging/Storage.c           |  4 ++++
 3 files changed, 17 insertions(+)

--- pillow-2.6.1.orig/libImaging/Storage.c
+++ pillow-2.6.1/libImaging/Storage.c
@@ -386,6 +386,10 @@ ImagingNew(const char* mode, int xsize,
     } else
         bytes = strlen(mode); /* close enough */
 
+    if (xsize < 0 || ysize < 0) {
+        return (Imaging) ImagingError_ValueError("bad image size");
+    }
+    
     if ((int64_t) xsize * (int64_t) ysize * bytes <= THRESHOLD) {
         im = ImagingNewBlock(mode, xsize, ysize);
         if (im)
