
--- pillow-5.4.1.orig/Tests/test_file_fpx.py
+++ pillow-5.4.1/Tests/test_file_fpx.py
@@ -1,3 +1,5 @@
+from PIL import Image
+
 from helper import unittest, PillowTestCase
 
 try:
@@ -22,6 +24,9 @@ class TestFileFpx(PillowTestCase):
         self.assertRaises(SyntaxError,
                           FpxImagePlugin.FpxImageFile, ole_file)
 
+    def test_fpx_invalid_number_of_bands(self):
+        with self.assertRaisesRegex(IOError, "Invalid number of bands"):
+            Image.open("Tests/images/input_bw_five_bands.fpx")
 
 if __name__ == '__main__':
     unittest.main()
--- pillow-5.4.1.orig/src/PIL/FpxImagePlugin.py
+++ pillow-5.4.1/src/PIL/FpxImagePlugin.py
@@ -101,7 +101,10 @@ class FpxImageFile(ImageFile.ImageFile):
         s = prop[0x2000002 | id]
 
         colors = []
-        for i in range(i32(s, 4)):
+        bands = i32(s, 4)
+        if bands > 4:
+            raise IOError("Invalid number of bands")
+        for i in range(bands):
             # note: for now, we ignore the "uncalibrated" flag
             colors.append(i32(s, 8+i*4) & 0x7fffffff)
 
